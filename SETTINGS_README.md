# ระบบตั้งค่าระบบแชท AI

## ภาพรวม

ระบบตั้งค่าระบบแชท AI ช่วยให้แอดมินสามารถปรับแต่งค่าต่าง ๆ ของระบบได้ผ่านหน้าเว็บไซต์ โดยไม่ต้องแก้ไขโค้ดโดยตรง

## การเข้าถึง

1. เข้าสู่ระบบแอดมินที่ `/admin`
2. คลิกที่เมนู "ตั้งค่า" ในแถบนำทาง
3. หรือเข้าไปที่ `/admin/settings` โดยตรง

## การตั้งค่าที่มีให้

### 1. การตั้งค่าแชท (Chat Settings)

#### ระยะเวลาดีเลย์ก่อนตอบผู้ใช้ (วินาที)
- **คำอธิบาย**: ระยะเวลารอเพื่อรวมข้อความหลายข้อความเข้าด้วยกันก่อนตอบกลับ
- **ค่าที่แนะนำ**: 3-10 วินาที
- **ผลกระทบ**: 
  - ค่าน้อย = ตอบกลับเร็วขึ้น แต่ไม่รวมข้อความ
  - ค่ามาก = รวมข้อความได้มากขึ้น แต่ตอบกลับช้าลง

#### จำนวนข้อความสูงสุดในคิว
- **คำอธิบาย**: จำนวนข้อความสูงสุดที่จะรอรวมก่อนตอบกลับ
- **ค่าที่แนะนำ**: 5-15 ข้อความ
- **ผลกระทบ**: 
  - ค่าน้อย = ควบคุมต้นทุนได้ดี แต่ไม่รวมข้อความ
  - ค่ามาก = รวมข้อความได้มากขึ้น แต่ใช้ token มากขึ้น

#### เปิดใช้งานการรวมข้อความ
- **คำอธิบาย**: รวมข้อความหลายข้อความเข้าด้วยกันก่อนส่งให้ AI ประมวลผล
- **ผลกระทบ**: 
  - เปิด = ประหยัด token, ตอบกลับเป็นชุด
  - ปิด = ตอบกลับทีละข้อความ, ใช้ token มากขึ้น

### 2. การตั้งค่า AI (AI Settings)

#### โมเดลสำหรับข้อความธรรมดา
- **gpt-5**: คุณภาพสูงสุด สำหรับงานที่ต้องการความแม่นยำ (แนะนำ)
- **gpt-5-mini**: ประหยัด สำหรับข้อความทั่วไป
- **gpt-5-chat-latest**: เวอร์ชันล่าสุดของ GPT-5
- **gpt-4.1**: คุณภาพสูง สำหรับงานที่ต้องการความแม่นยำ
- **o3**: ทางเลือกใหม่

#### โมเดลสำหรับรูปภาพ
- **gpt-5**: รองรับรูปภาพและข้อความ (แนะนำ)
- **gpt-5-mini**: รองรับรูปภาพพื้นฐาน
- **gpt-5-chat-latest**: รองรับรูปภาพล่าสุด
- **gpt-4.1**: รองรับรูปภาพคุณภาพสูง
- **o3**: รองรับรูปภาพ



#### จำนวนรูปภาพสูงสุดต่อข้อความ
- **คำอธิบาย**: จำกัดจำนวนรูปภาพที่ AI จะประมวลผลในครั้งเดียว
- **ค่าที่แนะนำ**: 2-5 รูปภาพ
- **ผลกระทบ**: 
  - ค่าน้อย = ประหยัดต้นทุน แต่ประมวลผลรูปภาพได้น้อย
  - ค่ามาก = ประมวลผลรูปภาพได้มากขึ้น แต่ใช้ token มากขึ้น

### 3. การตั้งค่าระบบ (System Settings)

#### สถานะการใช้งาน AI
- **เปิดใช้งาน**: AI ทำงานปกติ
- **ปิดใช้งาน**: AI ไม่ตอบกลับ แต่ยังบันทึกข้อความ

#### การบันทึกประวัติแชท
- **เปิดใช้งาน**: บันทึกประวัติการสนทนาทั้งหมด
- **ปิดใช้งาน**: ไม่บันทึกประวัติ (ประหยัดพื้นที่ฐานข้อมูล)

#### การแจ้งเตือนแอดมิน
- **เปิดใช้งาน**: แจ้งเตือนเมื่อมีข้อความใหม่
- **ปิดใช้งาน**: ไม่แจ้งเตือน (ลดการรบกวน)

#### โหมดการทำงาน
- **Production**: ใช้งานจริง (แนะนำ)
- **Development**: สำหรับพัฒนาและทดสอบ
- **Maintenance**: โหมดบำรุงรักษา (ไม่ตอบกลับผู้ใช้)

## การใช้งาน

### การบันทึกการตั้งค่า
1. เลือกแท็บที่ต้องการตั้งค่า
2. ปรับแต่งค่าตามต้องการ
3. คลิกปุ่ม "บันทึกการตั้งค่า..."
4. รอการยืนยันจากระบบ

### การรีเซ็ตค่าเริ่มต้น
หากต้องการกลับไปใช้ค่าเริ่มต้น ให้ลบข้อมูลในคอลเลกชัน `settings` ในฐานข้อมูล MongoDB

## ผลกระทบของการตั้งค่า

### ประสิทธิภาพ
- **ระยะเวลาดีเลย์**: กระทบความเร็วในการตอบกลับ
- **จำนวนข้อความในคิว**: กระทบการใช้ token และความแม่นยำ
- **โมเดล AI**: กระทบต้นทุนและคุณภาพการตอบกลับ

### ต้นทุน
- **โมเดลที่ใช้**: gpt-5 > gpt-5-mini > gpt-5-chat-latest > gpt-4.1 > o3
- **จำนวนรูปภาพ**: รูปภาพมากขึ้น = ใช้ token มากขึ้น


### คุณภาพ
- **โมเดล**: gpt-5 > gpt-5-chat-latest > gpt-4.1 > gpt-5-mini > o3


## การแก้ไขปัญหา

### ระบบไม่ตอบกลับ
1. ตรวจสอบสถานะ AI ในแท็บ "การตั้งค่าระบบ"
2. ตรวจสอบโหมดระบบ (ไม่ควรเป็น "maintenance")
3. ตรวจสอบการตั้งค่า LINE Bot

### การตั้งค่าไม่บันทึก
1. ตรวจสอบการเชื่อมต่อฐานข้อมูล
2. ตรวจสอบสิทธิ์การเขียนฐานข้อมูล
3. ดู error log ใน console

### AI ตอบกลับช้า
1. ลดระยะเวลาดีเลย์
2. ลดจำนวนข้อความในคิว
3. ใช้โมเดลที่เร็วขึ้น (gpt-5-mini)

## การสำรองข้อมูล

การตั้งค่าจะถูกเก็บในคอลเลกชัน `settings` ในฐานข้อมูล MongoDB สามารถสำรองข้อมูลได้โดย:

```bash
# Export settings
mongoexport --db chatbot --collection settings --out settings_backup.json

# Import settings
mongoimport --db chatbot --collection settings --file settings_backup.json
```

## หมายเหตุ

- การตั้งค่าจะมีผลทันทีหลังจากบันทึก
- ค่าเริ่มต้นจะถูกใช้หากไม่มีการตั้งค่า
- การตั้งค่าบางอย่างอาจต้องรีสตาร์ทระบบเพื่อให้มีผล
- แนะนำให้ทดสอบการตั้งค่าในโหมด Development ก่อนใช้งานจริง
